# お問合せフォーム機能 設計書

## 1. ユーザーニーズ
- サイト訪問者が管理者に対して手軽に連絡を取りたい。
- 送信した内容が確実に管理者に届き、かつ記録として残るようにしたい。
- 入力ミスを防ぐためのチェック機能が欲しい。

## 2. 仕様要件

### 2.1 画面仕様
- **URL**: `/contact`
- **UIコンポーネント**: Material UI (MUI) を使用
- **入力項目**:
  - **名前** (必須)
  - **メールアドレス** (必須、メール形式チェック)
  - **件名** (任意)
  - **本文** (必須)
- **アクション**:
  - 「送信」ボタン: クリックでバリデーション実行後、APIへ送信。
- **フィードバック**:
  - 送信成功時: 完了画面または完了メッセージを表示。
  - エラー時: エラーメッセージを表示。

### 2.2 バックエンド仕様 (API Route)
- **URL**: `/api/contact`
- **メソッド**: `POST`
- **処理内容**:
  1. リクエストボディのバリデーション。
  2. MongoDBへのデータ保存。
  3. Nodemailerを使用した管理者へのメール送信。
  4. レスポンス返却。

### 2.3 データベース (MongoDB)
- **コレクション名**: `contacts`
- **モデル名**: `Contact`
- **スキーマ定義**:
  - `name`: String (Required)
  - `email`: String (Required)
  - `subject`: String
  - `message`: String (Required)
  - `createdAt`: Date (Default: Date.now)

## 3. 処理手順設計

### Step 1: 環境構築 & 依存関係
- 必要なパッケージのインストール:
  - `@mui/material`, `@emotion/react`, `@emotion/styled` (UI用)
  - `mongoose` (DB用)
  - `nodemailer` (メール用)
  - `react-hook-form` (フォーム管理用、推奨)

### Step 2: データベース接続設定
- `lib/dbConnect.js` (またはutils) を作成し、MongoDBへの接続ロジックを実装。
- 環境変数 `MONGODB_URI` を設定。

### Step 3: Mongooseモデル作成
- `models/Contact.js` を作成。
- スキーマを定義し、モデルをエクスポート。

### Step 4: API Route実装
- `pages/api/contact.js` (または `app/api/contact/route.js`) を作成。
- POSTリクエストを受け取り、DB保存とメール送信を実行。
- Nodemailerの設定（SMTP情報など）は環境変数から読み込む。

### Step 5: フロントエンド実装
- `pages/contact.js` (または `app/contact/page.js`) を作成。
- MUIの `TextField`, `Button`, `Container`, `Typography` などを使用してレイアウト。
- バリデーションロジックの実装。
- APIへのPOST送信処理の実装。
- 送信完了/エラー状態の管理とUI表示。
